import { Suspense } from "react"
import Link from "next/link"

import { supabase } from "@/lib/supabase"
import { MainNav } from "@/components/main-nav"

import CartModal from "../cart/cart-modal"
import FridgeModal from "../fridge/fridge-modal"
import { StoreSelectorDialog } from "./store-selector"
import { UserNav } from "./user-nav"

export async function SiteHeader() {
  const { data, error } = await supabase
    .from("market_chain")
    .select("*,market_salepoint(*)")

  return (
    <header className="supports-backdrop-blur:bg-background/60 sticky top-0 z-40 w-full border-b bg-background/60 shadow-sm backdrop-blur">
      <div className="container flex h-16 items-center">
        <nav className="flex items-center space-x-6 w-full">
          <Link href="/">
            <svg
              width="74"
              height="28"
              viewBox="0 0 112 52"
              fill="none"
              xmlns="http://www.w3.org/2000/svg"
            >
              <path
                d="M13.2546 40.9621H3.04667V19.8869H0V15.7282L3.17231 14.3836V11.6633C3.17231 9.55783 3.46546 7.73382 4.05176 6.19122C4.63806 4.64863 5.45469 3.44999 6.50166 2.59531C7.56956 1.74063 8.74216 1.12568 10.0195 0.750452C11.3177 0.35438 12.7625 0.156344 14.3539 0.156344C15.7778 0.156344 17.1179 0.343956 18.3743 0.719183C19.6306 1.09441 20.4158 1.43836 20.7299 1.75105L19.5364 6.50391C18.5313 6.00361 17.4948 5.75346 16.4269 5.75346C16.1547 5.75346 15.9034 5.7743 15.6731 5.816C14.0608 6.06615 13.2546 7.43155 13.2546 9.91221V14.3836H17.3063V19.8869H13.2546V40.9621Z"
                fill="currentColor"
              />
              <path
                d="M30.1369 40.9621H19.9918V20.7312L18.1073 19.5743V16.0409L24.8602 14.3836H27.4043L28.3152 21.8256C29.1737 16.7184 31.9272 14.1648 36.5758 14.1648C37.0992 14.1648 37.6437 14.2586 38.209 14.4462L37.1411 25.5779C36.7014 25.1818 35.7382 24.9838 34.2515 24.9838C32.1157 24.9838 30.7442 25.5466 30.1369 26.6723V40.9621Z"
                fill="currentColor"
              />
              <path
                d="M40.696 40.9621V20.7312L38.8114 19.5743V16.2285L45.5644 14.3836H50.8097V40.9621H40.696ZM45.2503 11.5069L40.0992 6.34757V5.25316L45.2503 0.125074H46.4438L51.8148 5.25316V6.34757L46.4438 11.5069H45.2503Z"
                fill="currentColor"
              />
              <path
                d="M72.7005 40.9621L71.4755 36.9284C71.308 37.2203 71.1091 37.5121 70.8788 37.804C70.6694 38.0958 70.3239 38.471 69.8423 38.9296C69.3607 39.3674 68.8477 39.7531 68.3032 40.0866C67.7588 40.4201 67.0783 40.712 66.2617 40.9621C65.445 41.2123 64.5865 41.3373 63.6861 41.3373C60.2311 41.3373 57.6975 40.1596 56.0851 37.804C54.4728 35.4484 53.6667 32.1756 53.6667 27.9856C53.6667 25.359 54.0436 23.0243 54.7974 20.9814C55.5512 18.9176 56.7343 17.2604 58.3466 16.0096C59.9589 14.7589 61.9063 14.1335 64.1887 14.1335C65.5497 14.1335 66.7642 14.2794 67.8321 14.5713C68.9 14.8631 69.8213 15.2175 70.5961 15.6344V6.15995L67.1411 5.00301V1.56344L78.2599 0H80.7098V40.9621H72.7005ZM68.2718 35.2087C68.6487 35.2087 69.0361 35.1461 69.434 35.021C69.8318 34.8751 70.2192 34.6771 70.5961 34.4269V18.6987C69.947 18.5528 69.3502 18.4799 68.8058 18.4799C66.0209 18.5007 64.6179 20.6374 64.597 24.89V29.2676C64.597 31.2271 64.9425 32.7072 65.6335 33.7078C66.3245 34.7084 67.2039 35.2087 68.2718 35.2087Z"
                fill="currentColor"
              />
              <path
                d="M97.0493 52C95.4161 52 93.5734 51.6248 91.5213 50.8743C89.4693 50.1447 88.1396 49.4464 87.5324 48.7793L89.5112 44.4955C90.0346 44.8916 90.8827 45.2564 92.0553 45.5899C93.2279 45.9234 94.233 46.0902 95.0706 46.0902C95.9081 46.0902 96.6305 45.9755 97.2378 45.7462C97.866 45.5378 98.3476 45.2668 98.6826 44.9333C99.0176 44.6206 99.2898 44.2245 99.4992 43.745C99.7086 43.2864 99.8343 42.8695 99.8761 42.4943C99.9389 42.1191 99.9808 41.7021 100.002 41.2435V38.5857C98.2219 40.4201 96.0547 41.3373 93.5001 41.3373C90.0451 41.3373 87.5115 40.1596 85.8991 37.804C84.2868 35.4484 83.4806 32.1756 83.4806 27.9856C83.4806 26.0261 83.7005 24.2229 84.1402 22.5761C84.58 20.9084 85.2186 19.4492 86.0562 18.1984C86.9147 16.9268 88.0245 15.9367 89.3855 15.2279C90.7466 14.4983 92.2856 14.1335 94.0027 14.1335C96.5991 14.1335 98.8501 14.7068 100.756 15.8533L101.29 14.3836H106.095L112 14.6651V17.6043L110.115 18.9176V39.8052C110.115 47.9351 105.76 52 97.0493 52ZM98.0544 35.6464C98.6826 35.6464 99.3317 35.4692 100.002 35.1149V18.6362C99.4992 18.532 99.0386 18.4799 98.6198 18.4799C95.8348 18.5007 94.4319 20.6374 94.411 24.89V29.7366C94.411 31.0708 94.589 32.2173 94.9449 33.1762C95.5731 34.823 96.6096 35.6464 98.0544 35.6464Z"
                fill="currentColor"
              />
            </svg>
          </Link>

          {data && <StoreSelectorDialog market_chains={data} />}
          <MainNav />
        </nav>

        <UserNav
          Buttons={
            <Suspense>
              <FridgeModal />
              <CartModal />
            </Suspense>
          }
        />
      </div>
    </header>
  )
}
